{"ast":null,"code":"var _jsxFileName = \"/Users/draxzh/Documents/web project/sneaker_shopping/app/src/components/Products.js\";\nimport React from 'react';\nimport axios from 'commons/axios';\nimport ToolBox from './ToolBox';\nimport Product from './Product';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport Panel from 'components/Panel';\nimport AddInventory from 'components/AddInventory';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Products extends React.Component {\n  constructor() {\n    super(...arguments);\n    this.state = {\n      products: [],\n      //搜素后products的值会被更改\n      sourceProducts: [],\n      cartNum: 0\n    };\n\n    this.search = text => {\n      //Get New Array\n      let _products = [...this.state.sourceProducts]; //Filter New Array\n\n      _products = _products.filter(p => {\n        //拿到name调用match方法\n        const matchArray = p.name.match(new RegExp(text, 'gi'));\n        return !!matchArray;\n      }); //set state\n\n      this.setState({\n        products: _products\n      });\n    };\n\n    this.toAdd = () => {\n      Panel.open({\n        component: AddInventory,\n        callback: data => {\n          if (data) {\n            this.add(data);\n          }\n        }\n      });\n    };\n\n    this.add = product => {\n      const _products = [...this.state.products];\n\n      _products.push(product);\n\n      const _sProducts = [...this.state.sourceProducts];\n\n      _sProducts.push(product);\n\n      this.setState({\n        products: _products,\n        sourceProducts: _sProducts\n      });\n    };\n\n    this.update = product => {\n      const _products = [...this.state.products];\n\n      const index = _products.findIndex(p => p.id === product.id);\n\n      _products.splice(index, 1, product);\n\n      const _sProducts = [...this.state.sourceProducts];\n\n      const sourceIndex = _sProducts.findIndex(p => p.id === product.id);\n\n      _sProducts.splice(sourceIndex, 1, product);\n\n      this.setState({\n        products: _products,\n        sourceProducts: _sProducts\n      });\n    };\n\n    this.delete = id => {\n      const _products = this.state.products.filter(p => p.id !== id);\n\n      const _sProducts = this.state.sourceProducts.filter(p => p.id !== id);\n\n      this.setState({\n        products: _products,\n        sourceProducts: _sProducts\n      });\n    };\n\n    this.updateCartNum = async () => {\n      const cartNum = await this.initTotalCartNum();\n      this.setState({\n        cartNum: cartNum\n      });\n    };\n\n    this.initTotalCartNum = async () => {\n      const res = await axios.get('/carts'); //if there is no data in the response database, then we give an empty array.\n\n      const carts = res.data || []; //carts.map(cart =>cart.mount):get an array of the data from mount, for example [2,1,2]\n      //reduce((a, value)): add up the number in the array, 0 is initialized value\n\n      const cartNum = carts.map(cart => cart.mount).reduce((a, value) => a + value, 0);\n      return cartNum;\n    };\n\n    this.renderAddBtn = () => {\n      const user = global.auth.getUser() || {};\n\n      if (user.type === 1) {\n        return /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"button is-primary add-btn\",\n          onClick: this.toAdd,\n          children: \"ADD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }, this);\n      }\n    };\n  }\n\n  componentDidMount() {\n    axios.get('/products').then(response => {\n      this.setState({\n        products: response.data,\n        sourceProducts: response.data\n      });\n    });\n    this.updateCartNum();\n  } //search the products\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(ToolBox, {\n        search: this.search,\n        cartNum: this.state.cartNum\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"products\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"columns is-multiline is-dektop\",\n          children: /*#__PURE__*/_jsxDEV(TransitionGroup, {\n            component: null,\n            children: this.state.products.map(p => {\n              return /*#__PURE__*/_jsxDEV(CSSTransition, {\n                classNames: \"product-fade\",\n                timeout: 300,\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"column is-3\",\n                  children: /*#__PURE__*/_jsxDEV(Product, {\n                    product: p,\n                    update: this.update,\n                    delete: this.delete,\n                    updateCartNum: this.updateCartNum\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 127,\n                    columnNumber: 41\n                  }, this)\n                }, p.id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 126,\n                  columnNumber: 37\n                }, this)\n              }, p.id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 37\n              }, this);\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 21\n        }, this), this.renderAddBtn()]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Products;","map":{"version":3,"names":["React","axios","ToolBox","Product","CSSTransition","TransitionGroup","Panel","AddInventory","Products","Component","state","products","sourceProducts","cartNum","search","text","_products","filter","p","matchArray","name","match","RegExp","setState","toAdd","open","component","callback","data","add","product","push","_sProducts","update","index","findIndex","id","splice","sourceIndex","delete","updateCartNum","initTotalCartNum","res","get","carts","map","cart","mount","reduce","a","value","renderAddBtn","user","global","auth","getUser","type","componentDidMount","then","response","render"],"sources":["/Users/draxzh/Documents/web project/sneaker_shopping/app/src/components/Products.js"],"sourcesContent":["import React from 'react';\nimport axios from 'commons/axios';\nimport ToolBox from './ToolBox';\nimport Product from './Product';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport Panel from 'components/Panel';\nimport AddInventory from 'components/AddInventory';\n\nclass Products extends React.Component{\n    state = {\n        products:[],\n        //搜素后products的值会被更改\n        sourceProducts:[],\n        cartNum: 0,\n    };\n\n    componentDidMount(){\n        axios.get('/products').then(response=>{\n            this.setState({\n                products:response.data,\n                sourceProducts: response.data,\n\n            });\n        });\n        this.updateCartNum();\n    }\n    //search the products\n    search = text =>{\n        //Get New Array\n        let _products = [...this.state.sourceProducts]\n        //Filter New Array\n        _products = _products.filter(p=>{\n            //拿到name调用match方法\n            const matchArray =  p.name.match(new RegExp(text, 'gi'));\n            return !!matchArray;\n        })\n        //set state\n        this.setState({\n            products: _products\n        })\n    }\n    \n    toAdd=()=>{\n        Panel.open({\n            component: AddInventory,\n            callback: data =>{\n                if(data){\n                    this.add(data);\n                }\n            }\n        });\n    }\n\n    add = product =>{\n        const _products = [...this.state.products];\n        _products.push(product);\n        const _sProducts = [...this.state.sourceProducts];\n        _sProducts.push(product)\n\n        this.setState({\n            products:_products,\n            sourceProducts:_sProducts\n        })\n    }\n\n    update = product =>{\n        const _products = [...this.state.products];\n        const index = _products.findIndex(p=>p.id === product.id);\n        _products.splice(index, 1, product);\n        const _sProducts = [...this.state.sourceProducts];\n        const sourceIndex = _sProducts.findIndex(p => p.id === product.id);\n        _sProducts.splice(sourceIndex, 1, product);\n        this.setState({\n            products: _products,\n            sourceProducts: _sProducts\n        })\n    }\n\n    delete = id =>{\n        const _products = this.state.products.filter(p=>p.id !== id);\n        const _sProducts = this.state.sourceProducts.filter(p => p.id !== id)\n        this.setState({\n            products:_products,\n            sourceProducts : _sProducts\n        });\n    }\n\n    updateCartNum = async () => {\n        const cartNum = await this.initTotalCartNum();\n        this.setState({\n            cartNum: cartNum\n        });\n    }\n\n    //return total number from the cart\n    initTotalCartNum = async () => {\n        const res = await axios.get('/carts');\n        //if there is no data in the response database, then we give an empty array.\n        const carts = res.data || [];\n        //carts.map(cart =>cart.mount):get an array of the data from mount, for example [2,1,2]\n        //reduce((a, value)): add up the number in the array, 0 is initialized value\n        const cartNum = carts.map(cart => cart.mount).reduce((a, value) => a + value, 0);\n        return cartNum;\n    };\n\n    renderAddBtn = () =>{\n        const user = global.auth.getUser() || {};\n        if(user.type === 1){\n            return(\n                <button className=\"button is-primary add-btn\" onClick={this.toAdd}>ADD</button>\n            )\n        }\n    }\n\n    render(){\n        return(\n            <div>\n                <ToolBox search={this.search} cartNum={this.state.cartNum}/>\n                <div className=\"products\">\n                    <div className=\"columns is-multiline is-dektop\">\n                        <TransitionGroup component = {null}>\n                        {\n                            this.state.products.map(p=>{\n                                return(\n                                    <CSSTransition classNames=\"product-fade\" timeout ={300} key={p.id}>\n                                    <div className=\"column is-3\" key={p.id}>\n                                        <Product product={p} update={this.update} delete={this.delete} updateCartNum={this.updateCartNum}/>\n                                    </div>\n                                    </CSSTransition>\n                                );\n                            })\n                        }\n                        </TransitionGroup>\n                    </div>\n                    {this.renderAddBtn()}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Products;"],"mappings":"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"},"metadata":{},"sourceType":"module"}